[["index.html", "INTRODUCCIÓN A LA ESTABILIDAD FINANCIERA Capítulo 1 La importancia en la medición del riesgo sistémico 1.1 El mapa de riesgos", " INTRODUCCIÓN A LA ESTABILIDAD FINANCIERA LUIS ORTIZ-CEVALLOS 2022-02-24 Capítulo 1 La importancia en la medición del riesgo sistémico 1.1 El mapa de riesgos 1.1.1 Aplicación para una serie El caso de las remesas en El Salvador. Para conocer mejor esta metodología por favor revisar Ortiz (2019) library(&quot;zoo&quot;) library(&quot;xts&quot;) library(&quot;dplyr&quot;) library(&quot;ggplot2&quot;) library(&quot;ggrepel&quot;) library(&quot;ggthemes&quot;) REMESAS &lt;- as.xts(read.zoo(&quot;REMESAS.csv&quot;, index.column = 1, sep = &quot;;&quot;, header = TRUE, format = &quot;%d/%m/%Y&quot;)) SV &lt;- data.frame(date = index(REMESAS), coredata(REMESAS)) SV &lt;- mutate(SV, SLV_R = SLV/(IPC_SV/100)) SV &lt;- mutate(SV, DIFF = SLV_R - lag(SLV_R, n = 12)) SV &lt;- mutate(SV, G1 = (DIFF/(lag(SLV_R, n = 12))) * 100) BASE &lt;- data.frame(date = SV$date, coredata(SV$G1)) colnames(BASE) &lt;- c(&quot;date&quot;, &quot;SV&quot;) inicial &lt;- &quot;2002-01-01&quot; finalista &lt;- &quot;2021-09-01&quot; Data &lt;- filter(BASE, date &gt;= &quot;2002-01-01&quot; &amp; date &lt;= &quot;2021-09-01&quot;) dates &lt;- Data[, &quot;date&quot;] LARGO &lt;- length(dates) missing.color &lt;- &quot;white&quot; colours1T &lt;- c(&quot;forestgreen&quot;, &quot;yellow&quot;, &quot;red3&quot;) DIR &lt;- -1 VARIABLES &lt;- colnames(Data) VAR &lt;- Data[, VARIABLES[2]] VAR.DIR &lt;- VAR * DIR EMP &lt;- ecdf(VAR.DIR) QUANT &lt;- EMP(VAR.DIR) z &lt;- QUANT zz &lt;- z assign(paste0(VARIABLES[2], &quot;.s.lim&quot;), max(VAR, na.rm = T) + sd(VAR.DIR, na.rm = T)/2) assign(paste0(VARIABLES[2], &quot;.i.lim&quot;), min(VAR, na.rm = T) - sd(VAR.DIR, na.rm = T)/2) dates.s &lt;- Data$date[1] dates &lt;- Data$date for (t in seq_along(dates)[-1]) { mean.day &lt;- dates[t - 1] + ((dates[t] - dates[t - 1])/2) dates.s &lt;- c(dates.s, mean.day, dates[t]) } dates.s &lt;- c(dates.s[1] - 45, dates.s, dates.s[length(dates.s)] + 45) assign(paste0(VARIABLES[2]), VAR.DIR) for (t in seq_along(dates)[-length(dates)]) { pos &lt;- which(dates[t] == dates.s) assign(paste0(VARIABLES[2], &quot;.t.&quot;, t), dates.s[pos + c(-1, 0, 1)]) if (is.na(zz[t])) { assign(paste0(VARIABLES[2], &quot;.c.&quot;, t), rgb(matrix(col2rgb(missing.color), 1, 3)/255)) } else { assign(paste0(VARIABLES[2], &quot;.c.&quot;, t), rgb(colorRamp(colours1T)(z[t])/255)) } } DATOS &lt;- select(Data, date, SV) DATOS$date &lt;- as.Date(DATOS$date) DATOS$MAX &lt;- zz DATOS$INICIO &lt;- as.Date(DATOS$date) - 46 DATOS$FINAL &lt;- as.Date(DATOS$date) + 46 for (t in seq_along(dates)[c(-LARGO)]) { DATOS$COLOR[t] &lt;- get(paste0(VARIABLES[2], &quot;.c.&quot;, t)) } DATOS$COLOR[LARGO] &lt;- get(paste0(VARIABLES[2], &quot;.c.&quot;, LARGO - 1)) P_2 &lt;- paste0(&quot;+geom_rect(data = DATOS,aes(xmin =as.Date(&#39;&quot;, DATOS$INICIO[1], &quot;&#39;), xmax =as.Date(&#39;&quot;, DATOS$FINAL[1], &quot;&#39;),ymin = -Inf, ymax = Inf),fill =&#39;&quot;, DATOS$COLOR[1], &quot;&#39;,alpha = 0.05, color=&#39;transparent&#39;)&quot;) for (j in 2:LARGO) { P_2 &lt;- paste0(P_2, &quot;+geom_rect(data = DATOS,aes(xmin =as.Date(&#39;&quot;, DATOS$INICIO[j], &quot;&#39;), xmax =as.Date(&#39;&quot;, DATOS$FINAL[j], &quot;&#39;),ymin = -Inf, ymax = Inf),fill =&#39;&quot;, DATOS$COLOR[j], &quot;&#39;,alpha = 0.05, color=&#39;transparent&#39;)&quot;) } P_1 &lt;- &quot;ggplot(data = DATOS, aes(x = date, y=SV))+labs(y=&#39;&#39;, x=&#39;&#39;)&quot; P &lt;- paste0(P_1, P_2) PS &lt;- eval(parse(text = P)) PS &lt;- PS + geom_line(size = 1, color = &quot;blue&quot;) + labs(y = &quot;Porcentaje&quot;, x = &quot;&quot;, title = &quot;El Salvador: Tasa de crecimiento anual de \\n las remesas en términos reales y mapa de riesgo&quot;, caption = &quot;Fuente: Elaboración propia con base en Banco Central de Reserva de El Salvador.&quot;) + geom_hline(aes(yintercept = 0), color = &quot;black&quot;, size = 1, linetype = &quot;dashed&quot;) PS &lt;- PS + theme_classic() + theme(axis.line.x = element_line(colour = &quot;black&quot;, size = 0.5), axis.line.y.left = element_line(colour = &quot;black&quot;, size = 0.5), axis.line.y.right = element_blank(), axis.text.x = element_text(color = &quot;black&quot;, size = 8), axis.text.y = element_text(color = &quot;black&quot;, size = 14), axis.title.x = element_text(color = &quot;black&quot;, size = 18), axis.title.y = element_text(color = &quot;black&quot;, size = 18), plot.title = element_text(size = 16, hjust = 0.5, face = &quot;bold&quot;), plot.caption = element_text(size = 12, hjust = 0), panel.grid.major = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;#EAEAF2&quot;)) PS &lt;- PS + scale_x_date(date_breaks = &quot;24 month&quot;, date_labels = &quot;%b-%y&quot;) + scale_y_continuous(breaks = seq(-50, 125, by = 25), limits = c(-50, 125)) + coord_cartesian(xlim = as.Date(c(&quot;2002-01-01&quot;, &quot;2021-09-15&quot;))) ggsave(filename=&quot;SIVAR.jpg&quot;, plot = PS, #device = cairo_pdf, width = 297, height = 210, units = &quot;mm&quot;) PS "],["references.html", "References", " References "]]
