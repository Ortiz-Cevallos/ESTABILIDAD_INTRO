[["index.html", "INTRODUCCIÓN A LA ESTABILIDAD FINANCIERA Capítulo 1 La importancia en la medición del riesgo sistémico 1.1 El mapa de riesgos", " INTRODUCCIÓN A LA ESTABILIDAD FINANCIERA LUIS ORTIZ-CEVALLOS 2021-09-22 Capítulo 1 La importancia en la medición del riesgo sistémico 1.1 El mapa de riesgos 1.1.1 Aplicación para una series El caso de las remesas en El Salvador. Para conocer mejor esta metodología por favor revisar Ortiz (2019) library(&quot;zoo&quot;) library(&quot;xts&quot;) library(&quot;dplyr&quot;) library(&quot;ggplot2&quot;) library(&quot;ggrepel&quot;) library(&quot;ggthemes&quot;) REMESAS&lt;-as.xts(read.zoo(&quot;REMESAS.csv&quot;, index.column = 1, sep = &quot;;&quot;, header=TRUE, format = &quot;%d/%m/%Y&quot;)) SV&lt;-data.frame(date=index(REMESAS), coredata(REMESAS)) SV &lt;-mutate(SV, SLV_R = SLV/(IPC_SV/100)) SV &lt;-mutate(SV, DIFF = SLV_R-lag(SLV_R, n=12)) SV &lt;-mutate(SV, G1 = (DIFF/(lag(SLV_R, n=12)))*100) BASE&lt;-data.frame(date=SV$date, coredata(SV$G1)) colnames(BASE)&lt;- c(&quot;date&quot;, &quot;SV&quot;) inicial &lt;-&quot;2002-01-01&quot; finalista &lt;-&quot;2021-07-01&quot; Data &lt;- filter(BASE, date&gt;=&quot;2002-01-01&quot;&amp;date&lt;=&quot;2021-07-01&quot;) dates &lt;- Data[,&#39;date&#39;] LARGO &lt;- length(dates) missing.color &lt;- &quot;white&quot; colours1T &lt;- c(&#39;forestgreen&#39;,&#39;yellow&#39;,&#39;red3&#39;) DIR &lt;- -1 VARIABLES &lt;- colnames(Data) VAR &lt;- Data[, VARIABLES[2]] VAR.DIR &lt;- VAR*DIR EMP &lt;- ecdf(VAR.DIR) QUANT &lt;- EMP(VAR.DIR) z &lt;- QUANT zz &lt;- z assign(paste0(VARIABLES[2],&#39;.s.lim&#39;), max(VAR,na.rm=T)+sd(VAR.DIR,na.rm=T)/2) assign(paste0(VARIABLES[2],&#39;.i.lim&#39;), min(VAR,na.rm=T)-sd(VAR.DIR,na.rm=T)/2) dates.s &lt;- Data$date[1] dates &lt;- Data$date for (t in seq_along(dates)[-1]) { mean.day &lt;- dates[t-1] + ((dates[t]-dates[t-1])/2) dates.s &lt;- c(dates.s, mean.day, dates[t]) } dates.s &lt;- c(dates.s[1]-45, dates.s, dates.s[length(dates.s)]+45) assign(paste0(VARIABLES[2]), VAR.DIR) for (t in seq_along(dates)[-length(dates)]) { pos &lt;- which(dates[t]==dates.s) assign(paste0(VARIABLES[2],&#39;.t.&#39;,t),dates.s[pos+c(-1,0,1)]) if (is.na(zz[t])) { assign(paste0(VARIABLES[2],&#39;.c.&#39;,t),rgb(matrix(col2rgb(missing.color),1,3)/255)) } else { assign(paste0(VARIABLES[2],&#39;.c.&#39;,t),rgb(colorRamp(colours1T)(z[t])/255)) } } DATOS&lt;-select(Data, date, SV) DATOS$date&lt;-as.Date(DATOS$date) DATOS$MAX&lt;-zz DATOS$INICIO&lt;-as.Date(DATOS$date)-46 DATOS$FINAL &lt;-as.Date(DATOS$date)+46 for (t in seq_along(dates)[c(-LARGO)]) { DATOS$COLOR[t]&lt;-get(paste0(VARIABLES[2],&#39;.c.&#39;,t)) } DATOS$COLOR[LARGO]&lt;-get(paste0(VARIABLES[2],&#39;.c.&#39;,LARGO-1)) P_2 &lt;- paste0(&#39;+geom_rect(data = DATOS,aes(xmin =as.Date(\\&#39;&#39;,DATOS$INICIO[1],&#39;\\&#39;), xmax =as.Date(\\&#39;&#39;,DATOS$FINAL[1],&#39;\\&#39;),ymin = -Inf, ymax = Inf),fill =\\&#39;&#39;,DATOS$COLOR[1],&#39;\\&#39;,alpha = 0.05, color=\\&#39;transparent\\&#39;)&#39;) for (j in 2:LARGO){ P_2 &lt;- paste0(P_2, &#39;+geom_rect(data = DATOS,aes(xmin =as.Date(\\&#39;&#39;,DATOS$INICIO[j],&#39;\\&#39;), xmax =as.Date(\\&#39;&#39;,DATOS$FINAL[j],&#39;\\&#39;),ymin = -Inf, ymax = Inf),fill =\\&#39;&#39;,DATOS$COLOR[j],&#39;\\&#39;,alpha = 0.05, color=\\&#39;transparent\\&#39;)&#39;) } P_1&lt;-&quot;ggplot(data = DATOS, aes(x = date, y=SV))+labs(y=\\&#39;\\&#39;, x=\\&#39;\\&#39;)&quot; P &lt;-paste0(P_1,P_2) PS &lt;- eval(parse(text=P)) PS &lt;-PS+geom_line(size = 2, color = &quot;blue&quot;)+ ggtitle(&quot;Tasa de crecimiento anual de las remesas en términos reales y mapa de riesgo&quot;)+ geom_hline(aes(yintercept=0), color=&quot;black&quot;,size = 1.0, linetype = &quot;dashed&quot;) PS &lt;-PS+theme_classic()+theme( axis.line.x = element_line(colour = &quot;black&quot;, size = 1.0), axis.line.y = element_line(colour = &quot;black&quot;, size = 1.0), axis.line.y.right = element_blank(), axis.title.y = element_text(size=12), legend.title = element_blank(), legend.text = element_blank(), plot.title = element_text(size=10, hjust = 0.5, face=&quot;bold&quot;), panel.grid.major = element_line(size = 0.5, linetype = &#39;solid&#39;, colour = &quot;#EAEAF2&quot;), axis.text.x = element_text( color = &quot;black&quot;, size = 8), axis.text.y = element_text( color = &quot;black&quot;, size = 8) ) PS &lt;-PS+scale_x_date(date_breaks = &quot;24 month&quot;, date_labels = &quot;%Y&quot;)+ scale_y_continuous(breaks = seq(-50,50,by=5), limits = c(-50, 50))+ coord_cartesian(xlim = as.Date(c(&quot;2002-01-01&quot;, &quot;2021-07-15&quot;))) PS "],["references.html", "References", " References "]]
